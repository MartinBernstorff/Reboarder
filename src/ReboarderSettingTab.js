import { __awaiter } from "tslib";
import { SNOOZE_INTERVAL_KEY, SNOOZE_EXPIRE_KEY } from 'Main';
import { PluginSettingTab, Setting } from 'obsidian';
export class ReboarderSettingTab extends PluginSettingTab {
    constructor(app, plugin) {
        super(app, plugin);
        this.plugin = plugin;
    }
    display() {
        const { containerEl } = this;
        containerEl.empty();
        new Setting(containerEl)
            .setName('Card preview length')
            .setDesc('Maximum number of characters to show in card previews')
            .addText(text => text
            .setPlaceholder('200')
            .setValue(this.plugin.settings.cardPreviewLength.toString())
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            const parsed = parseInt(value);
            if (!isNaN(parsed) && parsed > 0) {
                this.plugin.settings.cardPreviewLength = parsed;
                yield this.plugin.saveSettings();
            }
        })));
        new Setting(containerEl)
            .setName('Default snooze duration')
            .setDesc('Default number of hours for custom snooze')
            .addText(text => text
            .setPlaceholder('24')
            .setValue(this.plugin.settings.defaultSnoozeHours.toString())
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            const parsed = parseInt(value);
            if (!isNaN(parsed) && parsed > 0) {
                this.plugin.settings.defaultSnoozeHours = parsed;
                yield this.plugin.saveSettings();
            }
        })));
        containerEl.createEl('h3', { text: 'Excluded Folders' });
        containerEl.createEl('p', {
            text: 'Folders to exclude from boards (one per line)',
            cls: 'setting-item-description'
        });
        // Snoozed notes (frontmatter) section
        containerEl.createEl('h3', { text: 'Snoozed Notes' });
        containerEl.createEl('p', { text: 'Notes currently snoozed (data stored in each note frontmatter).', cls: 'setting-item-description' });
        const snoozeContainer = containerEl.createEl('div', { cls: 'reboarder-snooze-list' });
        const formatDate = (ts) => {
            try {
                return new Date(ts).toLocaleString();
            }
            catch (_a) {
                return ts.toString();
            }
        };
        const refreshSnoozeList = () => {
            snoozeContainer.empty();
            const files = this.app.vault.getMarkdownFiles();
            const entries = [];
            files.forEach(f => {
                var _a;
                const fm = (_a = this.app.metadataCache.getFileCache(f)) === null || _a === void 0 ? void 0 : _a.frontmatter;
                if (!fm)
                    return;
                const interval = fm[SNOOZE_INTERVAL_KEY];
                const expire = fm[SNOOZE_EXPIRE_KEY];
                if (typeof interval === 'number' && typeof expire === 'number') {
                    entries.push({ file: f, interval, expire });
                }
            });
            if (entries.length === 0) {
                snoozeContainer.createEl('div', { text: 'No snoozed notes' });
                return;
            }
            entries.sort((a, b) => a.expire - b.expire).forEach(entry => {
                const { file, interval, expire } = entry;
                const row = snoozeContainer.createEl('div', { cls: 'reboarder-snooze-row' });
                row.createEl('div', { text: file.basename, cls: 'reboarder-snooze-name' });
                row.createEl('div', { text: file.path, cls: 'reboarder-snooze-path' });
                row.createEl('div', { text: `${interval}h`, cls: 'reboarder-snooze-interval' });
                row.createEl('div', { text: formatDate(expire), cls: 'reboarder-snooze-expire' });
                const status = Date.now() < expire ? 'active' : 'expired';
                row.createEl('div', { text: status, cls: `reboarder-snooze-status status-${status}` });
                const clearBtn = row.createEl('button', { text: 'Clear', cls: 'reboarder-snooze-clear' });
                clearBtn.addEventListener('click', () => __awaiter(this, void 0, void 0, function* () {
                    yield this.plugin.clearSnoozeEntry(file);
                    refreshSnoozeList();
                }));
            });
        };
        const expiredBtn = containerEl.createEl('button', { text: 'Remove expired snoozes', cls: 'mod-warning' });
        expiredBtn.addEventListener('click', () => __awaiter(this, void 0, void 0, function* () {
            const now = Date.now();
            const files = this.app.vault.getMarkdownFiles();
            for (const f of files) {
                const entry = this.plugin.getSnoozeEntry(f);
                if (entry && entry.expire <= now) {
                    yield this.plugin.clearSnoozeEntry(f);
                }
            }
            refreshSnoozeList();
        }));
        refreshSnoozeList();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVib2FyZGVyU2V0dGluZ1RhYi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlJlYm9hcmRlclNldHRpbmdUYWIudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDOUQsT0FBTyxFQUFFLGdCQUFnQixFQUFPLE9BQU8sRUFBUyxNQUFNLFVBQVUsQ0FBQztBQUVqRSxNQUFNLE9BQU8sbUJBQW9CLFNBQVEsZ0JBQWdCO0lBR3hELFlBQVksR0FBUSxFQUFFLE1BQXVCO1FBQzVDLEtBQUssQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDbkIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDdEIsQ0FBQztJQUVELE9BQU87UUFDTixNQUFNLEVBQUUsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQzdCLFdBQVcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUVwQixJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUM7YUFDdEIsT0FBTyxDQUFDLHFCQUFxQixDQUFDO2FBQzlCLE9BQU8sQ0FBQyx1REFBdUQsQ0FBQzthQUNoRSxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJO2FBQ25CLGNBQWMsQ0FBQyxLQUFLLENBQUM7YUFDckIsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsRUFBRSxDQUFDO2FBQzNELFFBQVEsQ0FBQyxDQUFPLEtBQUssRUFBRSxFQUFFO1lBQ3pCLE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ2pDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLGlCQUFpQixHQUFHLE1BQU0sQ0FBQztnQkFDaEQsTUFB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Q0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDdEM7YUFDRDtZQUNELGlCQUFpQixFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILGlCQUFpQixFQUFFLENBQUM7SUFDckIsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYm9hcmRlclBsdWdpbiBmcm9tICdhcHAvUmVib2FyZGVyUGx1Z2luJztcbmltcG9ydCB7IFNOT09aRV9JTlRFUlZBTF9LRVksIFNOT09aRV9FWFBJUkVfS0VZIH0gZnJvbSAnTWFpbic7XG5pbXBvcnQgeyBQbHVnaW5TZXR0aW5nVGFiLCBBcHAsIFNldHRpbmcsIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xuXG5leHBvcnQgY2xhc3MgUmVib2FyZGVyU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuXHRwbHVnaW46IFJlYm9hcmRlclBsdWdpbjtcblxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBSZWJvYXJkZXJQbHVnaW4pIHtcblx0XHRzdXBlcihhcHAsIHBsdWdpbik7XG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XG5cdH1cblxuXHRkaXNwbGF5KCk6IHZvaWQge1xuXHRcdGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cdFx0Y29udGFpbmVyRWwuZW1wdHkoKTtcblxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ0NhcmQgcHJldmlldyBsZW5ndGgnKVxuXHRcdFx0LnNldERlc2MoJ01heGltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMgdG8gc2hvdyBpbiBjYXJkIHByZXZpZXdzJylcblx0XHRcdC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuXHRcdFx0XHQuc2V0UGxhY2Vob2xkZXIoJzIwMCcpXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5jYXJkUHJldmlld0xlbmd0aC50b1N0cmluZygpKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0Y29uc3QgcGFyc2VkID0gcGFyc2VJbnQodmFsdWUpO1xuXHRcdFx0XHRcdGlmICghaXNOYU4ocGFyc2VkKSAmJiBwYXJzZWQgPiAwKSB7XG5cdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5jYXJkUHJldmlld0xlbmd0aCA9IHBhcnNlZDtcblx0XHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSkpO1xuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnRGVmYXVsdCBzbm9vemUgZHVyYXRpb24nKVxuXHRcdFx0LnNldERlc2MoJ0RlZmF1bHQgbnVtYmVyIG9mIGhvdXJzIGZvciBjdXN0b20gc25vb3plJylcblx0XHRcdC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuXHRcdFx0XHQuc2V0UGxhY2Vob2xkZXIoJzI0Jylcblx0XHRcdFx0LnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlZmF1bHRTbm9vemVIb3Vycy50b1N0cmluZygpKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0Y29uc3QgcGFyc2VkID0gcGFyc2VJbnQodmFsdWUpO1xuXHRcdFx0XHRcdGlmICghaXNOYU4ocGFyc2VkKSAmJiBwYXJzZWQgPiAwKSB7XG5cdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWZhdWx0U25vb3plSG91cnMgPSBwYXJzZWQ7XG5cdFx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pKTtcblxuXHRcdGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0V4Y2x1ZGVkIEZvbGRlcnMnIH0pO1xuXHRcdGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdwJywge1xuXHRcdFx0dGV4dDogJ0ZvbGRlcnMgdG8gZXhjbHVkZSBmcm9tIGJvYXJkcyAob25lIHBlciBsaW5lKScsXG5cdFx0XHRjbHM6ICdzZXR0aW5nLWl0ZW0tZGVzY3JpcHRpb24nXG5cdFx0fSk7XG5cblx0XHQvLyBTbm9vemVkIG5vdGVzIChmcm9udG1hdHRlcikgc2VjdGlvblxuXHRcdGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ1Nub296ZWQgTm90ZXMnIH0pO1xuXHRcdGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdwJywgeyB0ZXh0OiAnTm90ZXMgY3VycmVudGx5IHNub296ZWQgKGRhdGEgc3RvcmVkIGluIGVhY2ggbm90ZSBmcm9udG1hdHRlcikuJywgY2xzOiAnc2V0dGluZy1pdGVtLWRlc2NyaXB0aW9uJyB9KTtcblx0XHRjb25zdCBzbm9vemVDb250YWluZXIgPSBjb250YWluZXJFbC5jcmVhdGVFbCgnZGl2JywgeyBjbHM6ICdyZWJvYXJkZXItc25vb3plLWxpc3QnIH0pO1xuXG5cdFx0Y29uc3QgZm9ybWF0RGF0ZSA9ICh0czogbnVtYmVyKSA9PiB7XG5cdFx0XHR0cnkgeyByZXR1cm4gbmV3IERhdGUodHMpLnRvTG9jYWxlU3RyaW5nKCk7IH0gY2F0Y2ggeyByZXR1cm4gdHMudG9TdHJpbmcoKTsgfVxuXHRcdH07XG5cblx0XHRjb25zdCByZWZyZXNoU25vb3plTGlzdCA9ICgpID0+IHtcblx0XHRcdHNub296ZUNvbnRhaW5lci5lbXB0eSgpO1xuXHRcdFx0Y29uc3QgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCk7XG5cdFx0XHRjb25zdCBlbnRyaWVzOiB7IGZpbGU6IFRGaWxlOyBpbnRlcnZhbDogbnVtYmVyOyBleHBpcmU6IG51bWJlcjsgfVtdID0gW107XG5cdFx0XHRmaWxlcy5mb3JFYWNoKGYgPT4ge1xuXHRcdFx0XHRjb25zdCBmbSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGYpPy5mcm9udG1hdHRlcjtcblx0XHRcdFx0aWYgKCFmbSkgcmV0dXJuO1xuXHRcdFx0XHRjb25zdCBpbnRlcnZhbCA9IGZtW1NOT09aRV9JTlRFUlZBTF9LRVldO1xuXHRcdFx0XHRjb25zdCBleHBpcmUgPSBmbVtTTk9PWkVfRVhQSVJFX0tFWV07XG5cdFx0XHRcdGlmICh0eXBlb2YgaW50ZXJ2YWwgPT09ICdudW1iZXInICYmIHR5cGVvZiBleHBpcmUgPT09ICdudW1iZXInKSB7XG5cdFx0XHRcdFx0ZW50cmllcy5wdXNoKHsgZmlsZTogZiwgaW50ZXJ2YWwsIGV4cGlyZSB9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRpZiAoZW50cmllcy5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0c25vb3plQ29udGFpbmVyLmNyZWF0ZUVsKCdkaXYnLCB7IHRleHQ6ICdObyBzbm9vemVkIG5vdGVzJyB9KTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0ZW50cmllcy5zb3J0KChhLCBiKSA9PiBhLmV4cGlyZSAtIGIuZXhwaXJlKS5mb3JFYWNoKGVudHJ5ID0+IHtcblx0XHRcdFx0Y29uc3QgeyBmaWxlLCBpbnRlcnZhbCwgZXhwaXJlIH0gPSBlbnRyeTtcblx0XHRcdFx0Y29uc3Qgcm93ID0gc25vb3plQ29udGFpbmVyLmNyZWF0ZUVsKCdkaXYnLCB7IGNsczogJ3JlYm9hcmRlci1zbm9vemUtcm93JyB9KTtcblx0XHRcdFx0cm93LmNyZWF0ZUVsKCdkaXYnLCB7IHRleHQ6IGZpbGUuYmFzZW5hbWUsIGNsczogJ3JlYm9hcmRlci1zbm9vemUtbmFtZScgfSk7XG5cdFx0XHRcdHJvdy5jcmVhdGVFbCgnZGl2JywgeyB0ZXh0OiBmaWxlLnBhdGgsIGNsczogJ3JlYm9hcmRlci1zbm9vemUtcGF0aCcgfSk7XG5cdFx0XHRcdHJvdy5jcmVhdGVFbCgnZGl2JywgeyB0ZXh0OiBgJHtpbnRlcnZhbH1oYCwgY2xzOiAncmVib2FyZGVyLXNub296ZS1pbnRlcnZhbCcgfSk7XG5cdFx0XHRcdHJvdy5jcmVhdGVFbCgnZGl2JywgeyB0ZXh0OiBmb3JtYXREYXRlKGV4cGlyZSksIGNsczogJ3JlYm9hcmRlci1zbm9vemUtZXhwaXJlJyB9KTtcblx0XHRcdFx0Y29uc3Qgc3RhdHVzID0gRGF0ZS5ub3coKSA8IGV4cGlyZSA/ICdhY3RpdmUnIDogJ2V4cGlyZWQnO1xuXHRcdFx0XHRyb3cuY3JlYXRlRWwoJ2RpdicsIHsgdGV4dDogc3RhdHVzLCBjbHM6IGByZWJvYXJkZXItc25vb3plLXN0YXR1cyBzdGF0dXMtJHtzdGF0dXN9YCB9KTtcblx0XHRcdFx0Y29uc3QgY2xlYXJCdG4gPSByb3cuY3JlYXRlRWwoJ2J1dHRvbicsIHsgdGV4dDogJ0NsZWFyJywgY2xzOiAncmVib2FyZGVyLXNub296ZS1jbGVhcicgfSk7XG5cdFx0XHRcdGNsZWFyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLmNsZWFyU25vb3plRW50cnkoZmlsZSk7XG5cdFx0XHRcdFx0cmVmcmVzaFNub296ZUxpc3QoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXG5cdFx0Y29uc3QgZXhwaXJlZEJ0biA9IGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdidXR0b24nLCB7IHRleHQ6ICdSZW1vdmUgZXhwaXJlZCBzbm9vemVzJywgY2xzOiAnbW9kLXdhcm5pbmcnIH0pO1xuXHRcdGV4cGlyZWRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XG5cdFx0XHRjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXHRcdFx0Y29uc3QgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCk7XG5cdFx0XHRmb3IgKGNvbnN0IGYgb2YgZmlsZXMpIHtcblx0XHRcdFx0Y29uc3QgZW50cnkgPSB0aGlzLnBsdWdpbi5nZXRTbm9vemVFbnRyeShmKTtcblx0XHRcdFx0aWYgKGVudHJ5ICYmIGVudHJ5LmV4cGlyZSA8PSBub3cpIHtcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5jbGVhclNub296ZUVudHJ5KGYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRyZWZyZXNoU25vb3plTGlzdCgpO1xuXHRcdH0pO1xuXG5cdFx0cmVmcmVzaFNub296ZUxpc3QoKTtcblx0fVxufVxuIl19