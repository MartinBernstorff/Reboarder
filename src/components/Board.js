import { __awaiter } from "tslib";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { Card } from './Card';
import { useLiveQuery } from '@tanstack/react-db';
import { isFileRecordSnoozed } from 'src/ReboarderPlugin';
export const Board = ({ folder, plugin, onOpenNote }) => {
    const files = useLiveQuery((q) => q.from({ boards: plugin.fileCollection }))
        .data;
    const fileNames = files.map(f => f.name);
    const boardFiles = files
        .filter(it => it.path.contains(folder.path))
        .filter(it => !isFileRecordSnoozed(it))
        .sort((a, b) => b.mtime - a.mtime);
    const createNewNote = () => __awaiter(void 0, void 0, void 0, function* () {
        try {
            // Generate a unique file name
            const baseName = 'New Note';
            let fileName = `${baseName}.md`;
            let idx = 1;
            while (fileNames.contains(fileName)) {
                fileName = `${baseName} ${idx}.md`;
                idx++;
            }
            yield plugin.fileCollection.insert({
                name: fileName,
                mtime: Date.now(),
                path: folder.path + '/' + fileName,
                snoozeInfo: { interval: undefined, expireTime: undefined }
            });
        }
        catch (e) {
            console.error('Failed to create note', e);
        }
    });
    return (_jsxs("div", Object.assign({ className: "reboarder-board" }, { children: [_jsxs("div", Object.assign({ style: { display: 'flex', alignItems: 'center', justifyContent: 'space-between', gap: '8px', marginBottom: '8px' } }, { children: [_jsx("h3", Object.assign({ className: "reboarder-board-title", style: { marginBottom: 0 } }, { children: folder.name })), _jsx("button", Object.assign({ className: "reboarder-new-note-btn", onClick: createNewNote, "aria-label": "Add new note" }, { children: "+ New" }))] })), _jsx("div", Object.assign({ className: "reboarder-cards-container" }, { children: boardFiles.length === 0 ? (_jsx("div", Object.assign({ className: "reboarder-empty-board" }, { children: "No notes in this folder" }))) : (boardFiles.map((fileRecord) => (_jsx(Card, { file: fileRecord, plugin: plugin, onUnpin: () => __awaiter(void 0, void 0, void 0, function* () {
                        console.log("Attempting to unpin note:", fileRecord);
                        console.log("Current path:", fileRecord.path);
                        console.log("New path will be:", fileRecord.name);
                        const newPath = fileRecord.name;
                        try {
                            console.log("Calling update with key:", fileRecord.path);
                            const result = yield plugin.fileCollection.update(fileRecord.name, (draft) => {
                                draft.path = newPath;
                            });
                            console.log("Update completed, result:", result);
                        }
                        catch (error) {
                            console.error("Error updating file:", error);
                        }
                    }), onOpen: () => onOpenNote(fileRecord), onDelete: () => __awaiter(void 0, void 0, void 0, function* () { return yield plugin.fileCollection.delete(fileRecord.name); }) }, fileRecord.path)))) }))] })));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQm9hcmQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJCb2FyZC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFFQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzlCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNsRCxPQUF3QixFQUFjLG1CQUFtQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFRdkYsTUFBTSxDQUFDLE1BQU0sS0FBSyxHQUF5QixDQUFDLEVBQzNDLE1BQU0sRUFDTixNQUFNLEVBQ04sVUFBVSxFQUNWLEVBQUUsRUFBRTtJQUNKLE1BQU0sS0FBSyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQztTQUMxRSxJQUFJLENBQUE7SUFFTixNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXpDLE1BQU0sVUFBVSxHQUFHLEtBQUs7U0FDdEIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzNDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsbUJBQW1CLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDdEMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7SUFHcEMsTUFBTSxhQUFhLEdBQUcsR0FBUyxFQUFFO1FBQ2hDLElBQUk7WUFDSCw4QkFBOEI7WUFDOUIsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDO1lBQzVC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LGtEQUFDLE9BQUEsTUFBTSxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUEsR0FBQSxJQW5CcEUsVUFBVSxDQUFDLElBQUksQ0FvQm5CLENBQ0YsQ0FBQyxDQUNGLElBQ0ksS0FDRCxDQUNOLENBQUM7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgVEZvbGRlciB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IENhcmQgfSBmcm9tICcuL0NhcmQnO1xuaW1wb3J0IHsgdXNlTGl2ZVF1ZXJ5IH0gZnJvbSAnQHRhbnN0YWNrL3JlYWN0LWRiJztcbmltcG9ydCBSZWJvYXJkZXJQbHVnaW4sIHsgRmlsZVJlY29yZCwgaXNGaWxlUmVjb3JkU25vb3plZCB9IGZyb20gJ2FwcC9SZWJvYXJkZXJQbHVnaW4nO1xuXG5pbnRlcmZhY2UgQm9hcmRQcm9wcyB7XG5cdGZvbGRlcjogVEZvbGRlcjtcblx0cGx1Z2luOiBSZWJvYXJkZXJQbHVnaW47XG5cdG9uT3Blbk5vdGU6IChmaWxlOiBGaWxlUmVjb3JkKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY29uc3QgQm9hcmQ6IFJlYWN0LkZDPEJvYXJkUHJvcHM+ID0gKHtcblx0Zm9sZGVyLFxuXHRwbHVnaW4sXG5cdG9uT3Blbk5vdGVcbn0pID0+IHtcblx0Y29uc3QgZmlsZXMgPSB1c2VMaXZlUXVlcnkoKHEpID0+IHEuZnJvbSh7IGJvYXJkczogcGx1Z2luLmZpbGVDb2xsZWN0aW9uIH0pKVxuXHRcdC5kYXRhXG5cblx0Y29uc3QgZmlsZU5hbWVzID0gZmlsZXMubWFwKGYgPT4gZi5uYW1lKTtcblxuXHRjb25zdCBib2FyZEZpbGVzID0gZmlsZXNcblx0XHQuZmlsdGVyKGl0ID0+IGl0LnBhdGguY29udGFpbnMoZm9sZGVyLnBhdGgpKVxuXHRcdC5maWx0ZXIoaXQgPT4gIWlzRmlsZVJlY29yZFNub296ZWQoaXQpKVxuXHRcdC5zb3J0KChhLCBiKSA9PiBiLm10aW1lIC0gYS5tdGltZSk7XG5cblxuXHRjb25zdCBjcmVhdGVOZXdOb3RlID0gYXN5bmMgKCkgPT4ge1xuXHRcdHRyeSB7XG5cdFx0XHQvLyBHZW5lcmF0ZSBhIHVuaXF1ZSBmaWxlIG5hbWVcblx0XHRcdGNvbnN0IGJhc2VOYW1lID0gJ05ldyBOb3RlJztcblx0XHRcdGxldCBmaWxlTmFtZSA9IGAke2Jhc2VOYW1lfS5tZGA7XG5cdFx0XHRsZXQgaWR4ID0gMTtcblx0XHRcdHdoaWxlIChmaWxlTmFtZXMuY29udGFpbnMoZmlsZU5hbWUpKSB7XG5cdFx0XHRcdGZpbGVOYW1lID0gYCR7YmFzZU5hbWV9ICR7aWR4fS5tZGA7XG5cdFx0XHRcdGlkeCsrO1xuXHRcdFx0fVxuXG5cdFx0XHRhd2FpdCBwbHVnaW4uZmlsZUNvbGxlY3Rpb24uaW5zZXJ0KHtcblx0XHRcdFx0bmFtZTogZmlsZU5hbWUsXG5cdFx0XHRcdG10aW1lOiBEYXRlLm5vdygpLFxuXHRcdFx0XHRwYXRoOiBmb2xkZXIucGF0aCArICcvJyArIGZpbGVOYW1lLFxuXHRcdFx0XHRzbm9vemVJbmZvOiB7IGludGVydmFsOiB1bmRlZmluZWQsIGV4cGlyZVRpbWU6IHVuZGVmaW5lZCB9XG5cdFx0XHR9KTtcblx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIG5vdGUnLCBlKTtcblx0XHR9XG5cdH07XG5cblx0cmV0dXJuIChcblx0XHQ8ZGl2IGNsYXNzTmFtZT1cInJlYm9hcmRlci1ib2FyZFwiPlxuXHRcdFx0PGRpdiBzdHlsZT17eyBkaXNwbGF5OiAnZmxleCcsIGFsaWduSXRlbXM6ICdjZW50ZXInLCBqdXN0aWZ5Q29udGVudDogJ3NwYWNlLWJldHdlZW4nLCBnYXA6ICc4cHgnLCBtYXJnaW5Cb3R0b206ICc4cHgnIH19PlxuXHRcdFx0XHQ8aDMgY2xhc3NOYW1lPVwicmVib2FyZGVyLWJvYXJkLXRpdGxlXCIgc3R5bGU9e3sgbWFyZ2luQm90dG9tOiAwIH19Pntmb2xkZXIubmFtZX08L2gzPlxuXHRcdFx0XHQ8YnV0dG9uIGNsYXNzTmFtZT1cInJlYm9hcmRlci1uZXctbm90ZS1idG5cIiBvbkNsaWNrPXtjcmVhdGVOZXdOb3RlfSBhcmlhLWxhYmVsPVwiQWRkIG5ldyBub3RlXCI+KyBOZXc8L2J1dHRvbj5cblx0XHRcdDwvZGl2PlxuXHRcdFx0PGRpdiBjbGFzc05hbWU9XCJyZWJvYXJkZXItY2FyZHMtY29udGFpbmVyXCI+XG5cdFx0XHRcdHtib2FyZEZpbGVzLmxlbmd0aCA9PT0gMCA/IChcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cInJlYm9hcmRlci1lbXB0eS1ib2FyZFwiPk5vIG5vdGVzIGluIHRoaXMgZm9sZGVyPC9kaXY+XG5cdFx0XHRcdCkgOiAoXG5cdFx0XHRcdFx0Ym9hcmRGaWxlcy5tYXAoKGZpbGVSZWNvcmQpID0+IChcblx0XHRcdFx0XHRcdDxDYXJkXG5cdFx0XHRcdFx0XHRcdGtleT17ZmlsZVJlY29yZC5wYXRofVxuXHRcdFx0XHRcdFx0XHRmaWxlPXtmaWxlUmVjb3JkfVxuXHRcdFx0XHRcdFx0XHRwbHVnaW49e3BsdWdpbn1cblx0XHRcdFx0XHRcdFx0b25VbnBpbj17YXN5bmMgKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiQXR0ZW1wdGluZyB0byB1bnBpbiBub3RlOlwiLCBmaWxlUmVjb3JkKTtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkN1cnJlbnQgcGF0aDpcIiwgZmlsZVJlY29yZC5wYXRoKTtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIk5ldyBwYXRoIHdpbGwgYmU6XCIsIGZpbGVSZWNvcmQubmFtZSk7XG5cdFx0XHRcdFx0XHRcdFx0Y29uc3QgbmV3UGF0aCA9IGZpbGVSZWNvcmQubmFtZTtcblx0XHRcdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJDYWxsaW5nIHVwZGF0ZSB3aXRoIGtleTpcIiwgZmlsZVJlY29yZC5wYXRoKTtcblx0XHRcdFx0XHRcdFx0XHRcdGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBsdWdpbi5maWxlQ29sbGVjdGlvbi51cGRhdGUoZmlsZVJlY29yZC5uYW1lLCAoZHJhZnQpID0+IHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZnQucGF0aCA9IG5ld1BhdGg7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiVXBkYXRlIGNvbXBsZXRlZCwgcmVzdWx0OlwiLCByZXN1bHQpO1xuXHRcdFx0XHRcdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgZmlsZTpcIiwgZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fX1cblx0XHRcdFx0XHRcdFx0b25PcGVuPXsoKSA9PiBvbk9wZW5Ob3RlKGZpbGVSZWNvcmQpfVxuXHRcdFx0XHRcdFx0XHRvbkRlbGV0ZT17YXN5bmMgKCkgPT4gYXdhaXQgcGx1Z2luLmZpbGVDb2xsZWN0aW9uLmRlbGV0ZShmaWxlUmVjb3JkLm5hbWUpfVxuXHRcdFx0XHRcdFx0Lz5cblx0XHRcdFx0XHQpKVxuXHRcdFx0XHQpfVxuXHRcdFx0PC9kaXY+XG5cdFx0PC9kaXY+XG5cdCk7XG59O1xuIl19
